apiVersion: batch/v1
kind: CronJob
metadata:
  name: fleet-cleanup-gitrepo-jobs
  namespace: fleet
spec:
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      backoffLimit: 1
      template:
        metadata:
          labels:
            app: fleet-job
        spec:
          containers:
            - args:
                - cleanup
                - gitjob
              command:
                - fleet
              image: rancher/fleet:v0.11.0
              name: cleanup
              securityContext:
                allowPrivilegeEscalation: false
                capabilities:
                  drop:
                    - ALL
                privileged: false
                readOnlyRootFilesystem: false
          nodeSelector:
            kubernetes.io/os: linux
          restartPolicy: Never
          securityContext:
            runAsGroup: 1000
            runAsNonRoot: true
            runAsUser: 1000
          serviceAccountName: gitjob
          tolerations:
            - effect: NoSchedule
              key: cattle.io/os
              operator: Equal
              value: linux
  schedule: "@daily"
  successfulJobsHistoryLimit: 0
